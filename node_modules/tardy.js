// http://code.tutsplus.com/tutorials/real-time-chat-with-nodejs-readline-socketio--cms-20953
var readline = require('readline');
rl = readline.createInterface(process.stdin, process.stdout);
rl.on('close', function () { process.exit(0); });

var hl_callback;

exports.output = function(messages) {
  process.stdout.clearLine();
  process.stdout.cursorTo(0);
  console.log.apply(null, Array.prototype.slice.call(arguments, 0));
  rl.prompt(true);
}

exports.tardy = function() {
  rl.prompt(true);
}

function clearprompt() {
  process.stdout.moveCursor(0, -1);
  process.stdout.clearLine();
  process.stdout.cursorTo(0);
}

exports.question = function(query, clear, callback) {
  if (clear) {
    return rl.question(query, function(m) {clearprompt(); callback(m);});
  } else {
    return rl.question(query, callback);
  }
}

function handle_line(line) {
  hl_callback(line);
  clearprompt();
  exports.tardy();
}

exports.onLine = function(callback) {
  hl_callback=callback;
  rl.on('line', handle_line);
}
